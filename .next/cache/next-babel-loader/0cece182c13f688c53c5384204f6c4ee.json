{"ast":null,"code":"var _jsxFileName = \"/Users/otnielvictoryfa/task2020/atur-tagihan/pages/pulsa-dan-data/[order_id]/index.js\";\nvar __jsx = React.createElement;\nimport React, { Component } from 'react';\nimport Router from 'next/router'; // material\n\nimport { Divider } from '@material-ui/core';\nimport TextField from '@material-ui/core/TextField';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\nimport axios from 'axios';\nimport { connect } from 'react-redux';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { TabPanel } from '../../../components/global-component/TabPanel'; // component\\\n\nimport ButtonBack from '../../../components/global-component/ButtonBack';\nimport { isNotUndefined, phoneReplace, phoneValidation } from '../../../utils/Validator';\nimport ProductItem from '../../../components/additional-product/ProductItem'; // redux\n\nimport { showSnackbar } from '../../../redux/snackbar/action';\nimport { getHashUrl } from '../../../utils/CommonUtils';\nimport { BlockDialog } from '../../../components/global-component/BlockDialog';\nexport class PulseAndData extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      provider_logo: '',\n      errorPhoneNumber: false,\n      tabIndex: 0,\n      productList: [],\n      lastPrefix: '0000',\n      isLoading: false,\n      dialogOpen: false,\n      phoneNumber: ''\n    };\n  }\n  /**\n   * @summary if apId == 7, then set index to paket data\n   */\n\n\n  componentDidMount() {\n    document.body.style.background = 'white';\n\n    if (localStorage.getItem('apId') === '7') {\n      this.setState({\n        tabIndex: 1\n      });\n    }\n\n    const orderId = getHashUrl();\n    this.setState({\n      orderId\n    }); // kalau belum ada customer id, redirect ke detail tagihan\n\n    const custId = localStorage.getItem('cId');\n\n    if (custId === null) {\n      this.props.showSnackbar('Anda tidak bisa mengakses halaman ini secara langsung', 'error');\n      Router.push(`/detail-tagihan/${orderId}`);\n    } else {\n      this.setState({\n        custId\n      });\n    }\n  }\n  /**\n   * @method phoneNumberWatcher\n   * @summary this method will do validation for each input on phone number form\n   * */\n\n\n  async phoneNumberWatcher(event) {\n    const {\n      value\n    } = event.target; // change input to match format\n\n    await this.setState({\n      phoneNumber: phoneReplace(value)\n    });\n    const {\n      phoneNumber,\n      lastPrefix\n    } = this.state;\n\n    if (phoneNumber.length >= 4) {\n      // get the prefix\n      const valuePrefix = value.substring(0, 4); // get new price list if prefix is different\n\n      if (valuePrefix !== lastPrefix) {\n        this.setState({\n          lastPrefix: valuePrefix\n        });\n        this.getPriceList(valuePrefix);\n      } // phonumber length validation\n\n\n      this.setState({\n        errorPhoneNumber: !phoneValidation(phoneNumber)\n      });\n    } // reset all\n\n\n    if (phoneNumber.length < 4) {\n      this.setState({\n        provider_logo: '',\n        errorPhoneNumber: false,\n        productList: [],\n        lastPrefix: '0000'\n      });\n    }\n  }\n  /**\n   * @method getPriceList\n   * @summary get pricelist and operator logo by prefix\n   * if tab index 0 means pulsa (id 5)\n   * if tab index 1 means paket data (id 7)\n   *\n   * */\n\n\n  async getPriceList(prefix) {\n    this.setState({\n      isLoading: true\n    });\n    const {\n      showSnackbar\n    } = this.props;\n    const productId = this.state.tabIndex === 0 ? 5 : 7;\n    const BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;\n    const url = `${BASE_URL}/product_type/${productId}/products/atur_tagihan?operator_prefix__starts_with=${prefix}`;\n    await axios.get(url).then(async apiResponse => {\n      const {\n        response,\n        result\n      } = apiResponse.data;\n\n      if (response.code !== '000000') {\n        showSnackbar('Terjadi Gangguan', 'error');\n      } else {\n        this.mappingOperatorAndPrice(result);\n      }\n\n      this.setState({\n        isLoading: false\n      });\n    }).catch(async error => {\n      if (isNotUndefined(error.response)) {\n        const {\n          data\n        } = error.response;\n        showSnackbar(data.response.user_errors, 'error');\n      } else {\n        showSnackbar(error.toString(), 'error');\n      }\n\n      this.setState({\n        isLoading: false\n      });\n    });\n  }\n  /**\n   * @method mappingOperatorAndPrice\n   * @summary mapping product list to state and get provider logo price list found\n   * */\n\n\n  mappingOperatorAndPrice(productList) {\n    this.setState({\n      productList\n    });\n\n    if (productList.length > 0) {\n      this.setState({\n        provider_logo: productList[0].operator_icon\n      });\n    } else {\n      this.props.showSnackbar('Daftar harga tidak ditemukan', 'error');\n    }\n  }\n  /**\n   * @summary this method is to set tab index and local storage based on tab index value\n   * then hit end point by last prefix\n   * use async and await so this will be not async\n   * */\n\n\n  async onTabChange(newValue) {\n    const {\n      lastPrefix\n    } = this.state;\n    await this.setState({\n      tabIndex: newValue\n    });\n    localStorage.setItem('apId', newValue === 0 ? '5' : '7');\n    if (lastPrefix !== '0000') this.getPriceList(lastPrefix);\n  }\n  /**\n   * @method addToCart\n   * @summary add selected item to cart by post using order_idenifier, customer_id, and price_id\n   * @param price_id\n   * @returns {Promise<void>}\n   */\n\n\n  async addToCart(price_id) {\n    const {\n      showSnackbar\n    } = this.props;\n\n    if (this.state.errorPhoneNumber) {\n      showSnackbar('Masukkan nomor telepon dengan benar', 'error');\n    } else {\n      const order_identifier = this.state.phoneNumber;\n      const customer_id = this.state.custId;\n      this.setState({\n        dialogOpen: true\n      });\n      const BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;\n      const url = `${BASE_URL}/cart/atur_tagihan`;\n      const headers = {\n        'Content-Type': 'application/json'\n      };\n      const data = JSON.stringify({\n        customer_id: parseInt(customer_id, 10),\n        price_id,\n        order_identifier\n      });\n      await axios.post(url, data, {\n        headers\n      }).then(async apiResponse => {\n        const {\n          response\n        } = apiResponse.data;\n\n        if (response.code !== '000000') {\n          showSnackbar('Terjadi Gangguan', 'error');\n        } else {\n          Router.push(`/detail-tagihan/${this.state.orderId}`);\n        }\n\n        this.setState({\n          dialogOpen: false\n        });\n      }).catch(error => {\n        if (isNotUndefined(error.response)) {\n          const {\n            data\n          } = error.response;\n          showSnackbar(data.response.user_errors, 'error');\n        } else {\n          showSnackbar(error.toString(), 'error');\n        }\n\n        this.setState({\n          dialogOpen: false\n        });\n      });\n    }\n  }\n\n  render() {\n    const {\n      tabIndex,\n      productList,\n      isLoading,\n      dialogOpen,\n      errorPhoneNumber,\n      phoneNumber\n    } = this.state;\n    const productItem = productList.length > 0 ? __jsx(\"div\", {\n      className: \"additional-product-content\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 7\n      }\n    }, productList.map(item => __jsx(ProductItem, {\n      key: item.id,\n      title: item.product_name,\n      desc: item.product_desc,\n      price: item.sell_price,\n      onClick: () => this.addToCart(item.price_id),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210,\n        columnNumber: 11\n      }\n    }))) : null;\n    const displayItem = isLoading ? __jsx(CircularProgress, {\n      style: {\n        position: 'absolute',\n        left: '47%',\n        top: '60%'\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221,\n        columnNumber: 7\n      }\n    }) : productItem;\n    return __jsx(\"div\", {\n      className: \"main-content\",\n      id: \"mainContent\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226,\n        columnNumber: 7\n      }\n    }, __jsx(ButtonBack, {\n      id: \"btnBack\",\n      onClick: () => Router.back(),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227,\n        columnNumber: 9\n      }\n    }), __jsx(Divider, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 9\n      }\n    }), __jsx(\"div\", {\n      className: \"margin-top-24 margin-btm-8\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229,\n        columnNumber: 9\n      }\n    }, __jsx(\"p\", {\n      className: \"font-muli-18 bold\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 11\n      }\n    }, \"Pulsa & Paket Data\"), __jsx(TextField, {\n      id: \"phoneNumberField\",\n      placeholder: \"contoh: 081234567891\",\n      fullWidth: true,\n      margin: \"normal\",\n      InputProps: {\n        endAdornment: __jsx(InputAdornment, {\n          position: \"end\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 238,\n            columnNumber: 17\n          }\n        }, __jsx(\"img\", {\n          src: this.state.provider_logo,\n          style: {\n            maxHeight: '18px'\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 19\n          }\n        }))\n      },\n      inputProps: {\n        maxLength: 13,\n        pattern: '[0-9]'\n      },\n      label: \"Masukkan no handphone\",\n      variant: \"filled\",\n      color: \"primary\",\n      onChange: event => this.phoneNumberWatcher(event),\n      error: errorPhoneNumber,\n      helperText: errorPhoneNumber ? 'Nomor telepon 11 sampai 13 digit' : '',\n      value: phoneNumber // type=\"number\"\n      // onPaste={(event) => this.getPriceList(event.clipboardData.getData('Text'))}\n      // onKeyDown={(event) => event.key === 'Enter'? console.log(\"asu\") : console.log(\"juju asu\")}\n      ,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231,\n        columnNumber: 11\n      }\n    })), __jsx(Tabs, {\n      value: tabIndex,\n      indicatorColor: \"primary\",\n      onChange: (event, newValue) => this.onTabChange(newValue),\n      centered: true,\n      variant: \"fullWidth\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 258,\n        columnNumber: 9\n      }\n    }, __jsx(Tab, {\n      label: __jsx(\"span\", {\n        className: \"font-muli-14 bold\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 23\n        }\n      }, \"Pulsa\"),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265,\n        columnNumber: 11\n      }\n    }), __jsx(Tab, {\n      label: __jsx(\"span\", {\n        className: \"font-muli-14 bold\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 266,\n          columnNumber: 23\n        }\n      }, \"Paket Data\"),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266,\n        columnNumber: 11\n      }\n    })), __jsx(TabPanel, {\n      value: tabIndex,\n      index: 0,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 268,\n        columnNumber: 9\n      }\n    }, displayItem), __jsx(TabPanel, {\n      value: tabIndex,\n      index: 1,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 9\n      }\n    }, displayItem), __jsx(BlockDialog, {\n      isOpen: dialogOpen,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 9\n      }\n    }));\n  }\n\n}\nconst mapDispatchToProps = {\n  showSnackbar\n};\nexport default connect(null, mapDispatchToProps)(PulseAndData);","map":{"version":3,"sources":["/Users/otnielvictoryfa/task2020/atur-tagihan/pages/pulsa-dan-data/[order_id]/index.js"],"names":["React","Component","Router","Divider","TextField","InputAdornment","Tabs","Tab","axios","connect","CircularProgress","TabPanel","ButtonBack","isNotUndefined","phoneReplace","phoneValidation","ProductItem","showSnackbar","getHashUrl","BlockDialog","PulseAndData","constructor","props","state","provider_logo","errorPhoneNumber","tabIndex","productList","lastPrefix","isLoading","dialogOpen","phoneNumber","componentDidMount","document","body","style","background","localStorage","getItem","setState","orderId","custId","push","phoneNumberWatcher","event","value","target","length","valuePrefix","substring","getPriceList","prefix","productId","BASE_URL","process","env","NEXT_PUBLIC_API_BASE_URL","url","get","then","apiResponse","response","result","data","code","mappingOperatorAndPrice","catch","error","user_errors","toString","operator_icon","onTabChange","newValue","setItem","addToCart","price_id","order_identifier","customer_id","headers","JSON","stringify","parseInt","post","render","productItem","map","item","id","product_name","product_desc","sell_price","displayItem","position","left","top","back","endAdornment","maxHeight","maxLength","pattern","mapDispatchToProps"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Router from 'next/router';\n\n// material\nimport { Divider } from '@material-ui/core';\nimport TextField from '@material-ui/core/TextField';\nimport InputAdornment from '@material-ui/core/InputAdornment';\nimport Tabs from '@material-ui/core/Tabs';\nimport Tab from '@material-ui/core/Tab';\nimport axios from 'axios';\nimport { connect } from 'react-redux';\nimport CircularProgress from '@material-ui/core/CircularProgress';\nimport { TabPanel } from '../../../components/global-component/TabPanel';\n\n// component\\\nimport ButtonBack from '../../../components/global-component/ButtonBack';\nimport { isNotUndefined, phoneReplace, phoneValidation } from '../../../utils/Validator';\nimport ProductItem from '../../../components/additional-product/ProductItem';\n// redux\nimport { showSnackbar } from '../../../redux/snackbar/action';\nimport { getHashUrl } from '../../../utils/CommonUtils';\nimport { BlockDialog } from '../../../components/global-component/BlockDialog';\n\nexport class PulseAndData extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      provider_logo: '',\n      errorPhoneNumber: false,\n      tabIndex: 0,\n      productList: [],\n      lastPrefix: '0000',\n      isLoading: false,\n      dialogOpen: false,\n      phoneNumber: '',\n    };\n  }\n\n  /**\n   * @summary if apId == 7, then set index to paket data\n   */\n  componentDidMount() {\n    document.body.style.background = 'white';\n    if (localStorage.getItem('apId') === '7') {\n      this.setState({ tabIndex: 1 });\n    }\n    const orderId = getHashUrl();\n    this.setState({ orderId });\n\n    // kalau belum ada customer id, redirect ke detail tagihan\n    const custId = localStorage.getItem('cId');\n    if (custId === null) {\n      this.props.showSnackbar('Anda tidak bisa mengakses halaman ini secara langsung', 'error');\n      Router.push(`/detail-tagihan/${orderId}`);\n    } else {\n      this.setState({ custId });\n    }\n  }\n\n  /**\n   * @method phoneNumberWatcher\n   * @summary this method will do validation for each input on phone number form\n   * */\n  async phoneNumberWatcher(event) {\n    const { value } = event.target;\n\n    // change input to match format\n    await this.setState({ phoneNumber: phoneReplace(value) });\n    const { phoneNumber, lastPrefix } = this.state;\n\n    if (phoneNumber.length >= 4) {\n      // get the prefix\n      const valuePrefix = value.substring(0, 4);\n\n      // get new price list if prefix is different\n      if (valuePrefix !== lastPrefix) {\n        this.setState({ lastPrefix: valuePrefix });\n        this.getPriceList(valuePrefix);\n      }\n\n      // phonumber length validation\n      this.setState({ errorPhoneNumber: !phoneValidation(phoneNumber) });\n    }\n\n    // reset all\n    if (phoneNumber.length < 4) {\n      this.setState({\n        provider_logo: '', errorPhoneNumber: false, productList: [], lastPrefix: '0000',\n      });\n    }\n  }\n\n  /**\n   * @method getPriceList\n   * @summary get pricelist and operator logo by prefix\n   * if tab index 0 means pulsa (id 5)\n   * if tab index 1 means paket data (id 7)\n   *\n   * */\n  async getPriceList(prefix) {\n    this.setState({ isLoading: true });\n    const { showSnackbar } = this.props;\n    const productId = this.state.tabIndex === 0 ? 5 : 7;\n    const BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;\n    const url = `${BASE_URL}/product_type/${productId}/products/atur_tagihan?operator_prefix__starts_with=${prefix}`;\n\n    await axios\n      .get(url)\n      .then(async (apiResponse) => {\n        const { response, result } = apiResponse.data;\n\n        if (response.code !== '000000') {\n          showSnackbar('Terjadi Gangguan', 'error');\n        } else {\n          this.mappingOperatorAndPrice(result);\n        }\n        this.setState({ isLoading: false });\n      })\n      .catch(async (error) => {\n        if (isNotUndefined(error.response)) {\n          const { data } = error.response;\n          showSnackbar(data.response.user_errors, 'error');\n        } else {\n          showSnackbar(error.toString(), 'error');\n        }\n        this.setState({ isLoading: false });\n      });\n  }\n\n  /**\n   * @method mappingOperatorAndPrice\n   * @summary mapping product list to state and get provider logo price list found\n   * */\n  mappingOperatorAndPrice(productList) {\n    this.setState({ productList });\n    if (productList.length > 0) {\n      this.setState({ provider_logo: productList[0].operator_icon });\n    } else {\n      this.props.showSnackbar('Daftar harga tidak ditemukan', 'error');\n    }\n  }\n\n  /**\n   * @summary this method is to set tab index and local storage based on tab index value\n   * then hit end point by last prefix\n   * use async and await so this will be not async\n   * */\n  async onTabChange(newValue) {\n    const { lastPrefix } = this.state;\n    await this.setState({ tabIndex: newValue });\n    localStorage.setItem('apId', newValue === 0 ? '5' : '7');\n    if (lastPrefix !== '0000') this.getPriceList(lastPrefix);\n  }\n\n  /**\n   * @method addToCart\n   * @summary add selected item to cart by post using order_idenifier, customer_id, and price_id\n   * @param price_id\n   * @returns {Promise<void>}\n   */\n  async addToCart(price_id) {\n    const { showSnackbar } = this.props;\n\n    if (this.state.errorPhoneNumber) {\n      showSnackbar('Masukkan nomor telepon dengan benar', 'error');\n    } else {\n      const order_identifier = this.state.phoneNumber;\n      const customer_id = this.state.custId;\n      this.setState({ dialogOpen: true });\n      const BASE_URL = process.env.NEXT_PUBLIC_API_BASE_URL;\n      const url = `${BASE_URL}/cart/atur_tagihan`;\n      const headers = {\n        'Content-Type': 'application/json',\n      };\n\n      const data = JSON.stringify({\n        customer_id: parseInt(customer_id, 10),\n        price_id,\n        order_identifier,\n      });\n      await axios\n        .post(url, data, { headers })\n        .then(async (apiResponse) => {\n          const { response } = apiResponse.data;\n          if (response.code !== '000000') {\n            showSnackbar('Terjadi Gangguan', 'error');\n          } else {\n            Router.push(`/detail-tagihan/${this.state.orderId}`);\n          }\n          this.setState({ dialogOpen: false });\n        }).catch((error) => {\n          if (isNotUndefined(error.response)) {\n            const { data } = error.response;\n            showSnackbar(data.response.user_errors, 'error');\n          } else {\n            showSnackbar(error.toString(), 'error');\n          }\n          this.setState({ dialogOpen: false });\n        });\n    }\n  }\n\n  render() {\n    const {\n      tabIndex, productList, isLoading, dialogOpen, errorPhoneNumber, phoneNumber,\n    } = this.state;\n    const productItem = productList.length > 0 ? (\n      <div className=\"additional-product-content\">\n        {productList.map((item) => (\n          <ProductItem\n            key={item.id}\n            title={item.product_name}\n            desc={item.product_desc}\n            price={item.sell_price}\n            onClick={() => this.addToCart(item.price_id)}\n          />\n        ))}\n      </div>\n    ) : null;\n    const displayItem = isLoading ? (\n      <CircularProgress style={{ position: 'absolute', left: '47%', top: '60%' }} />\n    ) : (\n      productItem\n    );\n    return (\n      <div className=\"main-content\" id=\"mainContent\">\n        <ButtonBack id=\"btnBack\" onClick={() => Router.back()} />\n        <Divider />\n        <div className=\"margin-top-24 margin-btm-8\">\n          <p className=\"font-muli-18 bold\">Pulsa & Paket Data</p>\n          <TextField\n            id=\"phoneNumberField\"\n            placeholder=\"contoh: 081234567891\"\n            fullWidth\n            margin=\"normal\"\n            InputProps={{\n              endAdornment: (\n                <InputAdornment position=\"end\">\n                  <img src={this.state.provider_logo} style={{ maxHeight: '18px' }} />\n                </InputAdornment>\n              ),\n            }}\n            inputProps={{ maxLength: 13, pattern: '[0-9]' }}\n            label=\"Masukkan no handphone\"\n            variant=\"filled\"\n            color=\"primary\"\n            onChange={(event) => this.phoneNumberWatcher(event)}\n            error={errorPhoneNumber}\n            helperText={errorPhoneNumber ? 'Nomor telepon 11 sampai 13 digit' : ''}\n            value={phoneNumber}\n            // type=\"number\"\n            // onPaste={(event) => this.getPriceList(event.clipboardData.getData('Text'))}\n            // onKeyDown={(event) => event.key === 'Enter'? console.log(\"asu\") : console.log(\"juju asu\")}\n\n          />\n        </div>\n\n        <Tabs\n          value={tabIndex}\n          indicatorColor=\"primary\"\n          onChange={(event, newValue) => this.onTabChange(newValue)}\n          centered\n          variant=\"fullWidth\"\n        >\n          <Tab label={<span className=\"font-muli-14 bold\">Pulsa</span>} />\n          <Tab label={<span className=\"font-muli-14 bold\">Paket Data</span>} />\n        </Tabs>\n        <TabPanel value={tabIndex} index={0}>\n          {displayItem}\n        </TabPanel>\n        <TabPanel value={tabIndex} index={1}>\n          {displayItem}\n        </TabPanel>\n\n        <BlockDialog isOpen={dialogOpen}/>\n      </div>\n    );\n  }\n}\n\nconst mapDispatchToProps = {\n  showSnackbar,\n};\nexport default connect(null, mapDispatchToProps)(PulseAndData);\n"]},"metadata":{},"sourceType":"module"}